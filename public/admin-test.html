<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minilatics - Analytics Demo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #000;
            color: #fff;
            line-height: 1.6;
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 2rem;
            color: #fff;
        }

        .demo-badge {
            background: #333;
            color: #fff;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.8rem;
            display: inline-block;
            margin-bottom: 2rem;
            border: 1px solid #555;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: #111;
            border: 1px solid #333;
            padding: 1.5rem;
            border-radius: 8px;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .section {
            margin-bottom: 3rem;
        }

        .section h2 {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: #fff;
        }

        .list {
            background: #111;
            border: 1px solid #333;
            border-radius: 8px;
            overflow: hidden;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #222;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .list-item-main {
            color: #fff;
            font-weight: 400;
        }

        .list-item-count {
            color: #999;
            font-size: 0.9rem;
        }

        .period-selector {
            margin-bottom: 2rem;
        }

        .period-selector select {
            background: #111;
            border: 1px solid #333;
            color: #fff;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-family: inherit;
        }

        .period-selector select:focus {
            outline: none;
            border-color: #666;
        }

        .copy-link {
            background: #111;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .copy-link h3 {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: #fff;
        }

        .copy-link p {
            color: #999;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .copy-link code {
            background: #000;
            border: 1px solid #333;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            color: #fff;
            display: block;
            word-break: break-all;
        }

        .chart-container {
            background: #111;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 3rem;
            overflow: hidden;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 2rem;
            color: #fff;
            text-align: center;
        }

        .chart-svg {
            width: 100%;
            height: 300px;
            overflow: visible;
        }

        .chart-line {
            fill: none;
            stroke: #fff;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            filter: url(#roughPaper);
        }

        .chart-area {
            fill: url(#gradient);
            opacity: 0.1;
        }

        .chart-dot {
            fill: #fff;
            stroke: #111;
            stroke-width: 3;
            r: 4;
        }

        .chart-dot:hover {
            r: 6;
            stroke-width: 2;
        }

        .chart-axis {
            stroke: #333;
            stroke-width: 1;
        }

        .chart-grid {
            stroke: #222;
            stroke-width: 0.5;
            stroke-dasharray: 2,2;
        }

        .chart-label {
            fill: #999;
            font-size: 0.75rem;
            font-family: 'Inter', sans-serif;
        }

        .chart-tooltip {
            background: #000;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 0.5rem;
            color: #fff;
            font-size: 0.8rem;
            position: absolute;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }

        .setup-container {
            background: #111;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .setup-title {
            font-size: 1.5rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: #fff;
        }

        .setup-description {
            color: #999;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .script-display {
            background: #000;
            border: 1px solid #333;
            padding: 1rem;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            color: #fff;
            margin-bottom: 2rem;
            word-break: break-all;
        }

        .verify-button {
            background: #fff;
            color: #000;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 4px;
            font-family: inherit;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .verify-button:hover {
            background: #e0e0e0;
        }

        .verify-button:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
        }

        .verification-status {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .verification-success {
            background: #1a4d3a;
            color: #4ade80;
            border: 1px solid #16a34a;
        }

        .verification-error {
            background: #4d1a1a;
            color: #f87171;
            border: 1px solid #dc2626;
        }

        .verification-waiting {
            background: #2d2d1a;
            color: #fbbf24;
            border: 1px solid #f59e0b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Minilatics</h1>
        
        <div class="demo-badge">
            📊 Demo with Test Data
        </div>
        
        <div id="setup-screen">
            <div class="setup-container">
                <div class="setup-title">🚀 Get Started</div>
                <div class="setup-description">
                    Add this one line to your website to start tracking analytics:
                </div>
                <div class="script-display">&lt;script src="https://minilatics.onrender.com/script.js" data-site-key="demo-site"&gt;&lt;/script&gt;</div>
                <button class="verify-button" id="verify-button" onclick="verifyTracking()">
                    Verify Tracking Script
                </button>
                <div id="verification-status" style="display: none;"></div>
            </div>
        </div>

        <div id="analytics-screen" style="display: none;">
            <div class="period-selector">
                <select id="period-select" onchange="loadStats()">
                    <option value="7">Last 7 days</option>
                    <option value="30" selected>Last 30 days</option>
                    <option value="90">Last 90 days</option>
                </select>
            </div>
        
            <div id="stats">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-views">2,847</div>
                    <div class="stat-label">Page Views</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="unique-visitors">1,329</div>
                    <div class="stat-label">Unique Visitors</div>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Page Views Over Time</div>
                <svg class="chart-svg" id="pageViewsChart">
                    <defs>
                        <filter id="roughPaper" x="0%" y="0%" width="100%" height="100%">
                            <feTurbulence baseFrequency="0.04" numOctaves="3" result="noise"/>
                            <feDisplacementMap in="SourceGraphic" in2="noise" scale="1"/>
                        </filter>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#fff;stop-opacity:0.3" />
                            <stop offset="100%" style="stop-color:#fff;stop-opacity:0" />
                        </linearGradient>
                    </defs>
                </svg>
                <div class="chart-tooltip" id="tooltip"></div>
            </div>

            <div class="section">
                <h2>Top Pages</h2>
                <div class="list" id="top-pages">
                    <div class="list-item">
                        <div class="list-item-main">/</div>
                        <div class="list-item-count">892 views</div>
                    </div>
                    <div class="list-item">
                        <div class="list-item-main">/about</div>
                        <div class="list-item-count">456 views</div>
                    </div>
                    <div class="list-item">
                        <div class="list-item-main">/blog</div>
                        <div class="list-item-count">321 views</div>
                    </div>
                    <div class="list-item">
                        <div class="list-item-main">/contact</div>
                        <div class="list-item-count">278 views</div>
                    </div>
                    <div class="list-item">
                        <div class="list-item-main">/projects</div>
                        <div class="list-item-count">234 views</div>
                    </div>
                    <div class="list-item">
                        <div class="list-item-main">/blog/first-post</div>
                        <div class="list-item-count">189 views</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Top Referrers</h2>
                <div class="list" id="top-referrers">
                    <div class="list-item">
                        <div class="list-item-main">https://google.com</div>
                        <div class="list-item-count">534 visits</div>
                    </div>
                    <div class="list-item">
                        <div class="list-item-main">https://twitter.com</div>
                        <div class="list-item-count">287 visits</div>
                    </div>
                    <div class="list-item">
                        <div class="list-item-main">https://github.com</div>
                        <div class="list-item-count">198 visits</div>
                    </div>
                    <div class="list-item">
                        <div class="list-item-main">https://linkedin.com</div>
                        <div class="list-item-count">156 visits</div>
                    </div>
                    <div class="list-item">
                        <div class="list-item-main">https://dev.to</div>
                        <div class="list-item-count">89 visits</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const siteKey = 'demo-site';
        
        // Check if tracking has been verified (stored in localStorage)
        const isTrackingVerified = localStorage.getItem(`tracking_verified_${siteKey}`) === 'true';
        
        if (isTrackingVerified) {
            showAnalytics();
        }

        function showSetupScreen() {
            document.getElementById('setup-screen').style.display = 'block';
            document.getElementById('analytics-screen').style.display = 'none';
        }

        function showAnalytics() {
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('analytics-screen').style.display = 'block';
            loadStats();
        }

        async function verifyTracking() {
            const button = document.getElementById('verify-button');
            const statusEl = document.getElementById('verification-status');
            
            // Show waiting status
            button.disabled = true;
            button.textContent = 'Verifying...';
            statusEl.style.display = 'block';
            statusEl.className = 'verification-status verification-waiting';
            statusEl.innerHTML = '⏳ Simulating verification check...';

            // Simulate verification process with demo data
            setTimeout(() => {
                statusEl.className = 'verification-status verification-success';
                statusEl.innerHTML = '✅ Tracking script verified! Found demo data with 2,847 page views.';
                
                // Store verification in localStorage
                localStorage.setItem(`tracking_verified_${siteKey}`, 'true');
                
                // Switch to analytics after a short delay
                setTimeout(() => {
                    showAnalytics();
                }, 2000);
            }, 2000);
        }

        // Add a reset function for testing
        function resetVerification() {
            localStorage.removeItem(`tracking_verified_${siteKey}`);
            showSetupScreen();
        }

        // Add keyboard shortcut for reset (Ctrl+Shift+R)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'R') {
                resetVerification();
            }
        });

        // Generate realistic test data
        function generateTestData(days) {
            const dailyViews = [];
            const endDate = new Date();
            
            for (let i = parseInt(days) - 1; i >= 0; i--) {
                const date = new Date(endDate);
                date.setDate(date.getDate() - i);
                // Use local date instead of UTC to avoid timezone issues
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const dateStr = `${year}-${month}-${day}`;
                
                // Generate realistic view patterns (weekends lower, some random spikes)
                const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                const baseViews = isWeekend ? 20 : 60;
                const randomFactor = Math.random() * 40;
                const trendFactor = ((parseInt(days) - 1 - i) / days) * 20; // Slight upward trend
                const views = Math.round(baseViews + randomFactor + trendFactor + (Math.random() > 0.9 ? 50 : 0));
                
                dailyViews.push({
                    date: dateStr,
                    views: views
                });
            }
            
            return dailyViews;
        }

        function loadStats() {
            const days = document.getElementById('period-select').value;
            
            // Update stats based on period
            const stats = {
                7: { views: 892, visitors: 345 },
                30: { views: 2847, visitors: 1329 },
                90: { views: 8924, visitors: 3892 }
            };
            
            document.getElementById('total-views').textContent = stats[days].views.toLocaleString();
            document.getElementById('unique-visitors').textContent = stats[days].visitors.toLocaleString();
            
            // Generate and render chart with test data
            const testData = generateTestData(days);
            renderPageViewsChart(testData, days);
        }

        function renderPageViewsChart(dailyViews, days) {
            const svg = document.getElementById('pageViewsChart');
            const tooltip = document.getElementById('tooltip');
            
            // Clear previous chart
            while (svg.children.length > 1) {
                svg.removeChild(svg.lastChild);
            }

            const margin = { top: 20, right: 30, bottom: 40, left: 50 };
            const width = 700 - margin.left - margin.right;
            const height = 260 - margin.top - margin.bottom;

            const maxViews = Math.max(...dailyViews.map(d => d.views), 1);
            
            // Create scales
            const xScale = (i) => margin.left + (i / (dailyViews.length - 1)) * width;
            const yScale = (value) => margin.top + height - (value / maxViews) * height;

            // Create main group
            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            svg.appendChild(g);

            // Draw grid lines
            for (let i = 0; i <= 5; i++) {
                const y = margin.top + (height / 5) * i;
                const gridLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                gridLine.setAttribute('x1', margin.left);
                gridLine.setAttribute('x2', margin.left + width);
                gridLine.setAttribute('y1', y);
                gridLine.setAttribute('y2', y);
                gridLine.setAttribute('class', 'chart-grid');
                g.appendChild(gridLine);
            }

            // Draw axes
            const xAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            xAxis.setAttribute('x1', margin.left);
            xAxis.setAttribute('x2', margin.left + width);
            xAxis.setAttribute('y1', margin.top + height);
            xAxis.setAttribute('y2', margin.top + height);
            xAxis.setAttribute('class', 'chart-axis');
            g.appendChild(xAxis);

            const yAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            yAxis.setAttribute('x1', margin.left);
            yAxis.setAttribute('x2', margin.left);
            yAxis.setAttribute('y1', margin.top);
            yAxis.setAttribute('y2', margin.top + height);
            yAxis.setAttribute('class', 'chart-axis');
            g.appendChild(yAxis);

            // Create path for area fill
            let areaPath = `M ${margin.left} ${margin.top + height}`;
            dailyViews.forEach((d, i) => {
                const x = xScale(i);
                const y = yScale(d.views);
                if (i === 0) {
                    areaPath += ` L ${x} ${y}`;
                } else {
                    areaPath += ` L ${x} ${y}`;
                }
            });
            areaPath += ` L ${margin.left + width} ${margin.top + height} Z`;

            const area = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            area.setAttribute('d', areaPath);
            area.setAttribute('class', 'chart-area');
            g.appendChild(area);

            // Create hand-drawn line path with slight irregularities
            let linePath = '';
            dailyViews.forEach((d, i) => {
                const x = xScale(i) + (Math.random() - 0.5) * 2; // Add slight randomness
                const y = yScale(d.views) + (Math.random() - 0.5) * 2;
                
                if (i === 0) {
                    linePath += `M ${x} ${y}`;
                } else {
                    // Use quadratic curves for smoother hand-drawn look
                    const prevX = xScale(i - 1) + (Math.random() - 0.5) * 2;
                    const prevY = yScale(dailyViews[i - 1].views) + (Math.random() - 0.5) * 2;
                    const midX = (prevX + x) / 2;
                    const midY = (prevY + y) / 2;
                    linePath += ` Q ${midX + (Math.random() - 0.5) * 4} ${midY + (Math.random() - 0.5) * 4} ${x} ${y}`;
                }
            });

            const line = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            line.setAttribute('d', linePath);
            line.setAttribute('class', 'chart-line');
            g.appendChild(line);

            // Add data points
            dailyViews.forEach((d, i) => {
                const x = xScale(i);
                const y = yScale(d.views);
                
                const dot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                dot.setAttribute('cx', x);
                dot.setAttribute('cy', y);
                dot.setAttribute('class', 'chart-dot');
                
                // Add hover effects
                dot.addEventListener('mouseenter', (e) => {
                    const date = new Date(d.date).toLocaleDateString();
                    tooltip.innerHTML = `${date}<br/>${d.views} views`;
                    tooltip.style.display = 'block';
                    tooltip.style.left = (e.pageX + 10) + 'px';
                    tooltip.style.top = (e.pageY - 10) + 'px';
                });
                
                dot.addEventListener('mouseleave', () => {
                    tooltip.style.display = 'none';
                });
                
                g.appendChild(dot);
            });

            // Add Y-axis labels
            for (let i = 0; i <= 5; i++) {
                const value = Math.round((maxViews / 5) * (5 - i));
                const y = margin.top + (height / 5) * i;
                
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', margin.left - 10);
                label.setAttribute('y', y + 4);
                label.setAttribute('text-anchor', 'end');
                label.setAttribute('class', 'chart-label');
                label.textContent = value;
                g.appendChild(label);
            }

            // Add X-axis labels (show every few days)
            const labelInterval = Math.max(1, Math.floor(dailyViews.length / 6));
            dailyViews.forEach((d, i) => {
                if (i % labelInterval === 0 || i === dailyViews.length - 1) {
                    const x = xScale(i);
                    const date = new Date(d.date);
                    const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    label.setAttribute('x', x);
                    label.setAttribute('y', margin.top + height + 20);
                    label.setAttribute('text-anchor', 'middle');
                    label.setAttribute('class', 'chart-label');
                    label.textContent = `${date.getMonth() + 1}/${date.getDate()}`;
                    g.appendChild(label);
                }
            });

            // Set SVG viewBox for responsiveness
            svg.setAttribute('viewBox', `0 0 700 300`);
        }

        // Don't auto-load stats anymore - only load after verification
    </script>
</body>
</html>
